<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · ConservativeRegridding.jl</title><meta name="title" content="Home · ConservativeRegridding.jl"/><meta property="og:title" content="Home · ConservativeRegridding.jl"/><meta property="twitter:title" content="Home · ConservativeRegridding.jl"/><meta name="description" content="Documentation for ConservativeRegridding.jl."/><meta property="og:description" content="Documentation for ConservativeRegridding.jl."/><meta property="twitter:description" content="Documentation for ConservativeRegridding.jl."/><meta property="og:url" content="https://juliageo.org/ConservativeRegridding.jl/stable/"/><meta property="twitter:url" content="https://juliageo.org/ConservativeRegridding.jl/stable/"/><link rel="canonical" href="https://juliageo.org/ConservativeRegridding.jl/stable/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>ConservativeRegridding.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Quick-Start:-SpeedyWeather-Grid-Transfer"><span>Quick Start: SpeedyWeather Grid Transfer</span></a></li><li><a class="tocitem" href="#Mathematics-of-Regridding"><span>Mathematics of Regridding</span></a></li><li><a class="tocitem" href="#API-Reference"><span>API Reference</span></a></li></ul></li><li><a class="tocitem" href="how_it_works/">How it works</a></li><li><span class="tocitem">Interfaces</span><ul><li><a class="tocitem" href="interfaces/trees/">Tree Interface</a></li><li><a class="tocitem" href="interfaces/regrid/">Regridding Interface</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaGeo/ConservativeRegridding.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaGeo/ConservativeRegridding.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="ConservativeRegridding.jl"><a class="docs-heading-anchor" href="#ConservativeRegridding.jl">ConservativeRegridding.jl</a><a id="ConservativeRegridding.jl-1"></a><a class="docs-heading-anchor-permalink" href="#ConservativeRegridding.jl" title="Permalink"></a></h1><p>ConservativeRegridding.jl provides functionality to regrid between two arbitrary grids. A grid is a tessellation of a space into polygons (or grid cells), each with an associated value. Data on a grid is referred to as a <em>field</em>, whereas the grid itself defines the tessellation.</p><p>Regridding is performed <strong>conservatively</strong>, meaning the area-weighted mean is preserved. This is achieved by computing the intersection areas between all combinations of grid cells from the source and destination grids. These intersection areas provide the weights for averaging from neighboring cells.</p><h2 id="Quick-Start:-SpeedyWeather-Grid-Transfer"><a class="docs-heading-anchor" href="#Quick-Start:-SpeedyWeather-Grid-Transfer">Quick Start: SpeedyWeather Grid Transfer</a><a id="Quick-Start:-SpeedyWeather-Grid-Transfer-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Start:-SpeedyWeather-Grid-Transfer" title="Permalink"></a></h2><p>Here&#39;s an example of regridding between two different geodesic grids from <a href="https://github.com/SpeedyWeather/SpeedyWeather.jl">SpeedyWeather.jl</a>:</p><pre><code class="language-julia hljs">using SpeedyWeather
using ConservativeRegridding

import GeoInterface as GI
import GeometryOps as GO

# Create random data on two different geodesic grid types
field1 = rand(OctaHEALPixGrid, 4)
field2 = rand(OctaminimalGaussianGrid, 4)

# Get the polygon vertices for each grid (each column is a polygon as (lon, lat) tuples)
# The Regridder constructor handles wrapping these as GeoInterface polygons and
# fixing antimeridian crossings internally
verts1 = RingGrids.get_gridcell_polygons(field1.grid)
verts2 = RingGrids.get_gridcell_polygons(field2.grid)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5×80 Matrix{Tuple{Float64, Float64}}:
 (90.0, 73.7992)  (180.0, 73.7992)  (270.0, 73.7992)  …  (0.0, -73.7992)
 (45.0, 52.8129)  (135.0, 52.8129)  (225.0, 52.8129)     (315.0, -90.0)
 (0.0, 73.7992)   (90.0, 73.7992)   (180.0, 73.7992)     (270.0, -73.7992)
 (45.0, 90.0)     (135.0, 90.0)     (225.0, 90.0)        (315.0, -52.8129)
 (90.0, 73.7992)  (180.0, 73.7992)  (270.0, 73.7992)     (0.0, -73.7992)</code></pre><pre><code class="language- hljs"># Build the regridder (precomputes intersection areas)
R = ConservativeRegridding.Regridder(verts1, verts2)</code></pre><pre><code class="language- hljs"># Regrid from field2 to field1
ConservativeRegridding.regrid!(field1, R, field2)</code></pre><pre><code class="language- hljs"># Regrid in the reverse direction using the transpose
ConservativeRegridding.regrid!(field2, transpose(R), field1)</code></pre><p>The key advantage is that the <code>Regridder</code> only needs to be constructed once. After that, both forward regridding (via <code>R</code>) and backward regridding (via <code>transpose(R)</code>) can be performed efficiently without recomputing intersection areas.</p><h2 id="Mathematics-of-Regridding"><a class="docs-heading-anchor" href="#Mathematics-of-Regridding">Mathematics of Regridding</a><a id="Mathematics-of-Regridding-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematics-of-Regridding" title="Permalink"></a></h2><h3 id="The-Intersection-Area-Matrix"><a class="docs-heading-anchor" href="#The-Intersection-Area-Matrix">The Intersection Area Matrix</a><a id="The-Intersection-Area-Matrix-1"></a><a class="docs-heading-anchor-permalink" href="#The-Intersection-Area-Matrix" title="Permalink"></a></h3><p>Conservative regridding is built around a matrix <span>$A$</span> of intersection areas between source and destination grid cells. For a source grid with <span>$m$</span> cells and a destination grid with <span>$n$</span> cells, the matrix <span>$A$</span> is <span>$n \times m$</span>, where each entry <span>$A_{ij}$</span> represents the area of intersection between destination cell <span>$i$</span> and source cell <span>$j$</span>.</p><p>The algorithm uses an efficient spatial tree structure (STRtree) to compute only the non-zero intersections, avoiding the <span>$O(nm)$</span> cost of checking all cell pairs.</p><h3 id="Forward-Regridding"><a class="docs-heading-anchor" href="#Forward-Regridding">Forward Regridding</a><a id="Forward-Regridding-1"></a><a class="docs-heading-anchor-permalink" href="#Forward-Regridding" title="Permalink"></a></h3><p>Let <span>$s$</span> be a vector of field values on the source grid and <span>$d$</span> the destination field values. The forward regrid operation computes:</p><p class="math-container">\[d_i = \frac{\sum_j A_{ij} s_j}{a^d_i}\]</p><p>or in matrix form:</p><p class="math-container">\[d = \frac{A s}{a^d}\]</p><p>where <span>$a^d_i$</span> is the area of destination cell <span>$i$</span>, and the division is element-wise. The matrix-vector product <span>$As$</span> yields values weighted by intersection areas, and the division by <span>$a^d$</span> normalizes to obtain the regridded field values.</p><h3 id="Backward-Regridding"><a class="docs-heading-anchor" href="#Backward-Regridding">Backward Regridding</a><a id="Backward-Regridding-1"></a><a class="docs-heading-anchor-permalink" href="#Backward-Regridding" title="Permalink"></a></h3><p>The same intersection matrix <span>$A$</span> can be reused for backward regridding by transposing it:</p><p class="math-container">\[\tilde{s} = \frac{A^T d}{a^s}\]</p><p>where <span>$a^s_j$</span> is the area of source cell <span>$j$</span>. The tilde on <span>$\tilde{s}$</span> emphasizes that the round-trip operation <span>$s \to d \to \tilde{s}$</span> does not recover the original field exactly—conservative regridding preserves the mean but generally reduces variance.</p><h3 id="Conservation-Property"><a class="docs-heading-anchor" href="#Conservation-Property">Conservation Property</a><a id="Conservation-Property-1"></a><a class="docs-heading-anchor-permalink" href="#Conservation-Property" title="Permalink"></a></h3><p>Conservative regridding preserves the area-weighted mean:</p><p class="math-container">\[\frac{\sum_i d_i a^d_i}{\sum_i a^d_i} = \frac{\sum_j s_j a^s_j}{\sum_j a^s_j}\]</p><p>This property holds when both grids cover the same total area. The areas can be computed from the regridder via row and column sums of <span>$A$</span>:</p><p class="math-container">\[a^d_i = \sum_j A_{ij} \quad \text{and} \quad a^s_j = \sum_i A_{ij}\]</p><h3 id="Implementation-Details"><a class="docs-heading-anchor" href="#Implementation-Details">Implementation Details</a><a id="Implementation-Details-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-Details" title="Permalink"></a></h3><p>In ConservativeRegridding.jl:</p><ul><li><strong>Sparse storage</strong>: The intersection matrix <span>$A$</span> is stored as a sparse matrix since most grid cell pairs do not intersect.</li><li><strong>STRtree acceleration</strong>: A Sort-Tile-Recursive tree enables efficient spatial queries to find intersecting cell pairs.</li><li><strong>GeometryOps integration</strong>: Polygon intersections and area calculations are handled by <a href="https://github.com/JuliaGeo/GeometryOps.jl">GeometryOps.jl</a>.</li><li>~<strong>Antimeridian handling</strong>: Polygons crossing the antimeridian are automatically fixed via <code>GeometryOps.fix</code>.~</li><li><strong>Normalization</strong>: By default, the intersection areas are normalized to improve numerical conditioning.</li></ul><h2 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h2><div class="admonition is-warning" id="Missing-docstring.-84db11e28aada659"><header class="admonition-header">Missing docstring.<a class="admonition-anchor" href="#Missing-docstring.-84db11e28aada659" title="Permalink"></a></header><div class="admonition-body"><p>Missing docstring for <code>ConservativeRegridding.Regridder</code>. Check Documenter&#39;s build log for details.</p></div></div><article><details class="docstring" open="true"><summary id="ConservativeRegridding.regrid!"><a class="docstring-binding" href="#ConservativeRegridding.regrid!"><code>ConservativeRegridding.regrid!</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">regrid!(
    dst_field::DenseVector,
    regridder::ConservativeRegridding.Regridder,
    src_field::DenseVector
) -&gt; DenseVector
</code></pre><p>Regrid data on <code>src_field</code> onto <code>dst_field</code> conservativly (mean-preserving) using the <code>regridder</code> matrix. <code>dst_area</code> is the area of each grid cell in <code>dst_field</code> and is used to normalize the result, if not provided, will recompute this from <code>regridder</code>. <code>src_field</code> and <code>dst_field</code> can be any n-dimensional array in which case it regridding of the 1st dimension is broadcast to additional dimensions.</p><p>Mathematics of regridding: if A are the intersection areas between the respective grids of the fields d (dst) and s (src), and aˢ and aᵈ are the areas of the source and destination grid cells, then <span>$d$</span> is computed via</p><p class="math-container">\[d = (A s) / aˢ \]</p><p>Note that by construction,</p><p class="math-container">\[    aᵈ = sum(A, 2)
    aˢ = sum(A, 1)\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaGeo/ConservativeRegridding.jl/blob/7f99b55c693ba72a54fdd05bb66af9396de2e501/src/regridder/regrid.jl#L1">source</a></section></details></article></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="how_it_works/">How it works »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Monday 19 January 2026 16:16">Monday 19 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
